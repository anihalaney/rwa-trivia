<ns-action-bar title="Profile" class="Roboto-Regular" showAdd="true"></ns-action-bar>
<StackLayout>
  <ActivityIndicator *ngIf="loaderBusy" [busy]="loaderBusy" width="100" height="100" marginTop="225"
    class="activity-indicator"></ActivityIndicator>
  <ScrollView *ngIf="!loaderBusy">
    <StackLayout  (tap)="hideKeyboard()"  [formGroup]="userForm" class="profile-settings Roboto-Regular">

      <StackLayout class="input-field ">
        <AbsoluteLayout>
          <Image [src]="profileImage.image" backgroundColor="gray" stretch="aspectFill" height="110" width="110"
            left="130" right="130" top="10" verticalAlignment="center" borderRadius="55" (tap)="onTakePhoto()"></Image>
          <Image src="~/assets/images/mobile/profile-image-icon.png" left="170" right="170" top="50" width="30"
            height="30" (tap)="onTakePhoto()"></Image>
        </AbsoluteLayout>
      </StackLayout>

      <StackLayout class="input-field">

        <Label [text]="user.displayName" class="input title" textWrap="true"></Label>
        <TextField #textField hint="@username" formControlName="name" class="input"></TextField>
        <Label *ngIf="userForm.controls.name.errors && !userForm.controls.name.pristine" class="error" textWrap="true"
          text="Name is required!"></Label>

        <TextField #textField hint="Display Name" formControlName="displayName" class="input"></TextField>
        <Label *ngIf="userForm.controls.displayName.errors && !userForm.controls.displayName.pristine" class=" error"
          textWrap="true" text="Display Name is required!"></Label>

        <TextField #textField hint="Location" formControlName="location" class="input"></TextField>
        <Label *ngIf="userForm.controls.location.errors && !userForm.controls.location.pristine" class="error"
          textWrap="true" text="Location is required!"></Label>

      </StackLayout>
      <StackLayout margin="5 10">
          <Button text="View as public profile" nsRouterLink="/user/profile/{{user.userId}}" class="btn-red Roboto-Medium" backgroundColor="#D4493D" color="#ffffff"
             height="50" stlRippleEffect></Button>
      </StackLayout>
      <CardView margin="5" android:elevation="20" ios:elevation="40" radius="15" class="gameplay">
        <StackLayout class="cardStyle" orientation="vertical" verticalAlignment="center" backgroundColor="#ffffff" height="100%" padding="0" margin="10">
          <StackLayout marginTop="10">
            <GridLayout rows="*,*,*,*,*,*" columns="auto,*,auto" marginTop="10">
              <Label text="Game Played" row="0" col="0" class="padding-5 text-black Hind-Bold" fontSize="16" verticalAlignment="center" ></Label>
              <GridLayout  row="0" col="2" rows="*, *" columns="*" class="padding-10">
                  <Label [text]="account?.gamePlayed" row="0" col="0" class="text-black" fontSize="16"></Label>
              </GridLayout>

              <Label text="Categories" row="1" col="0" class="padding-5 text-black Hind-Bold" fontSize="16" verticalAlignment="center" ></Label>
              <GridLayout  row="1" col="2" rows="*, *" columns="*" class="padding-10">
                  <Label [text]="account?.categories" row="0" col="0" class="text-black" fontSize="16"></Label>
              </GridLayout>
              
              <Label text="Win-Loss" row="2" col="0" class="padding-5 text-black Hind-Bold" fontSize="16" verticalAlignment="center" ></Label>
              <GridLayout  row="2" col="2" rows="*, *" columns="*" class="padding-10">
                  <Label text="{{account?.wins}}-{{account?.losses}}" row="0" col="0" class="text-black" fontSize="16"></Label>
              </GridLayout>

              
              <Label text="Badges" row="3" col="0" class="padding-5 text-black Hind-Bold" fontSize="16" verticalAlignment="center" ></Label>
              <GridLayout  row="3" col="2" rows="*, *" columns="*" class="padding-10">
                  <Label [text]="account?.badges" row="0" col="0" class="text-black" fontSize="16"></Label>
              </GridLayout>

              
              <Label text="Avg. answer time" row="4" col="0" class="padding-5 text-black Hind-Bold" fontSize="16" verticalAlignment="center" ></Label>
              <GridLayout  row="4" col="2" rows="*, *" columns="*" class="padding-10">
                  <Label [text]="account?.avgAnsTime" row="0" col="0" class="text-black" fontSize="16"></Label>
              </GridLayout>

              <Label text="Contribution" row="5" col="0" class="padding-5 text-black Hind-Bold" fontSize="16" verticalAlignment="center" ></Label>
              <GridLayout  row="5" col="2" rows="*, *" columns="*">
                  <Label [text]="account?.contribution" row="0" col="0" class="text-black" fontSize="16"></Label>
              </GridLayout>
            </GridLayout>
          </StackLayout>
        </StackLayout>
      </CardView>
      <StackLayout class="list-view" iosOverflowSafeArea="false" marginTop="12">
        <GridLayout class="grid-label" rows="auto,auto" columns="auto,*" iosOverflowSafeArea="false">
          <Label class="grid-label-text" row="0" col="0" text="PREFERRED CATEGORIES" textWrap="true"
            iosOverflowSafeArea="false"></Label>
          <Label row="0" col="1" class="fa expand-options" horizontalAlignment="right"
            text="{{ showSelectCategory ? '&#xf067;' : '&#xf068;' }}" textWrap="true" padding="4" borderWidth="2"
            borderColor="#A9A9A9" (tap)="showSelectCategory = !showSelectCategory" iosOverflowSafeArea="false"></Label>
        </GridLayout>
        <StackLayout visibility="{{ !showSelectCategory ? 'visible' : 'collapsed' }}">
          <GridLayout rows="auto,auto" columns="auto,*" class="two-player-option"
            *ngFor="let category of userCategories" (tap)="selectCategory(category)">
            <Label class="grid-label-text" [text]="category.categoryName" row="0" col="0" textWrap="true"></Label>
            <Image row="0" col="2" checked="true" horizontalAlignment="right" src="~/assets/images/check.png"
              height="25" width="25" marginLeft="10" verticalAlignment="center" marginRight="5"
              visibility="{{ category.isSelected ? 'visible' : 'hidden' }}"></Image>

          </GridLayout>
        </StackLayout>
      </StackLayout>

      <StackLayout class="list-view" iosOverflowSafeArea="false">

        <GridLayout class="grid-label" rows="auto,auto" columns="auto,*">
          <Label row="0" col="0" text="PREFERRED TAGS" textWrap="true"></Label>
          <Label row="0" col="1" class="fa expand-options" horizontalAlignment="right"
            text="{{ showSelectTag ? '&#xf067;' : '&#xf068;' }}" textWrap="true" padding="4" borderWidth="2"
            borderColor="#A9A9A9" (tap)="showSelectTag = !showSelectTag"></Label>
        </GridLayout>
        <StackLayout visibility="{{ !showSelectTag ? 'visible' : 'collapsed' }}" iosOverflowSafeArea="false">
          <GridLayout rows="auto,auto" columns="auto,*" class="two-player-option" *ngFor="let tag of enteredTags"
            iosOverflowSafeArea="false">
            <Label [text]="tag" row="0" col="0" textWrap="true" iosOverflowSafeArea="false"></Label>
            <Label id="cross-button" row="0" col="1" class="fa" text="&#xf00d;" textWrap="true"
              horizontalAlignment="right" (tap)="removeEnteredTag(tag)" iosOverflowSafeArea="false"></Label>
          </GridLayout>
          <GridLayout rows="auto,auto" columns="*,auto" class="two-player-option" iosOverflowSafeArea="false">
            <Label class="input-label" row="0" col="0" text="Add Tags" textWrap="true"></Label>
            <StackLayout row="1" col="0" tkExampleTitle tkToggleNavButton ios:backgroundColor="#ffffff">
              <RadAutoCompleteTextView #autocomplete hint="Select Tag" [items]="dataItems" completionMode="Contains"
                showCloseButton="true" (didAutoComplete)="onDidAutoComplete($event)"
                (textChanged)="onTextChanged($event)" border="none" ios:backgroundColor="#ffffff">
                <SuggestionView tkAutoCompleteSuggestionView>
                  <ng-template tkSuggestionItemTemplate let-item="item">
                    <StackLayout orientation="vertical" padding="10">
                      <Label [text]="item.text"></Label>
                    </StackLayout>
                  </ng-template>
                </SuggestionView>
              </RadAutoCompleteTextView>
            </StackLayout>
            <StackLayout row="1" col="1" marginLeft="10" horizontalAlignment="right">
              <Button ios:padding="10" text="Add" class="Roboto-Bold" stlRippleEffect (tap)="addCustomTag()" ></Button>
            </StackLayout>
          </GridLayout>
        </StackLayout>
      </StackLayout>

      <StackLayout class="list-view social-section" iosOverflowSafeArea="false">
        <StackLayout class="grid-label p-15">
          <Label textWrap="true" text="SOCIAL PROFILE"></Label>
        </StackLayout>
        <StackLayout class="input-field" *ngFor="let profile of socialProfileSettings; let i=index"
          iosOverflowSafeArea="false">
          <GridLayout rows="auto,auto,*" columns="*" *ngIf="profile.enable && i <= socialProfileShowLimit"
            iosOverflowSafeArea="false">
            <Label class="grid-label-text" [text]="profile.display" row="0" col="0" textWrap="true"></Label>

            <StackLayout class="text-box" row="1" col="0" orientation="horizontal">
              <Label verticalAlignment="center" class="label-link" (tap)="onSocialProfileInputFocus(i)" [text]="profile?.url" fontSize="14" textWrap="true"></Label>
              <TextField id="myInput" #myInput verticalAlignment="center" hint="Enter Profile ID" [formControlName]="profile.social_name" class="input-box"></TextField>
            </StackLayout>
            <Label *ngIf="userForm.get(profile.social_name).errors" class="error" text="Please enter valid profile id"
              row="2" col="0" textWrap="true"></Label>
          </GridLayout>
        </StackLayout>
        <Button class="p-15 showMore" horizontalAlignment="center"
          *ngIf="enableSocialProfile > socialProfileShowLimit + 1" text="Show more"
           stlRippleEffect (tap)="showMoreSocialProfile()"></Button>
      </StackLayout>

      <StackLayout class="profile-buttons">
        <Label text="Bulk upload Request" textWrap="true" padding="8"></Label>
        <Button *ngIf="(!user.bulkUploadPermissionStatus
        || user.bulkUploadPermissionStatus === NONE
        || user.bulkUploadPermissionStatus === PENDING)
        && !user.isRequestedBulkUpload" [text]="bulkUploadBtnText"
          backgroundColor="#ffffff" color="black" padding="10 0" (tap)="setBulkUploadRequest()" borderWidth="1" borderRadius="3" stlRippleEffect></Button>
        <Label class="sub-text" *ngIf="user.bulkUploadPermissionStatus === PENDING"
          text="Bulk upload requested on {{user.bulkUploadPermissionStatusUpdateTime | date : 'medium' }}."
          textWrap="true" padding="8"></Label>
        <Label class="sub-text" *ngIf="user.bulkUploadPermissionStatus === APPROVED"
          text="User has bulk upload privilege" textWrap="true" padding="8"></Label>
      </StackLayout>

      <StackLayout class="profile-buttons">
        <Button text="SAVE" class="Roboto-Medium" backgroundColor="#71b02f" color="#ffffff"
          padding="20 0" stlRippleEffect (tap)="onSubmit()"></Button>
      </StackLayout>


    </StackLayout>
  </ScrollView>
</StackLayout>